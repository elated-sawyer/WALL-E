[
    "# Rule 1: For action 'take', if the item is not present in the specified location, the action will fail; Checking Method: Check if the 'obj' in 'action' is not listed under 'items_in_locations' for the 'source' location in 'initial_state'. \ndef Rule_1_take(state, action, scene_graph):\n    if action['name'] == 'take':\n        obj = action['args']['obj']\n        source = action['args']['source']\n        \n        # Check if the object is in the specified source location\n        if obj not in state['items_in_locations'].get(source, []):\n            feedback = f\"Failed to take {obj} from {source} because it is not present.\"\n            success = False\n            suggestion = f\"Please check if the {obj} is in another location or try to find it.\"\n        else:\n            feedback = f\"Successfully took {obj} from {source}.\"\n            success = True\n            suggestion = \"\"\n    else:\n        feedback = f\"Action '{action['name']}' is not relevant to the rule.\"\n        success = True  # Success is True for non-relevant actions\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 3: For action 'take', if the agent is not at the specified location, the action will fail; Checking Method: Check if 'current_position' in 'initial_state' does not match the 'source' location in 'action'. \ndef Rule_3_take(state, action, scene_graph):\n    current_position = state['current_position']['location_name']\n    source = action['args']['source']\n    \n    if action['name'] == 'take':\n        if current_position != source:\n            feedback = \"Action failed: You are not at the specified location to take the item.\"\n            success = False\n            suggestion = f\"Please go to the position '{source}' to take the item.\"\n        else:\n            feedback = \"Action executed successfully: You have taken the item.\"\n            success = True\n            suggestion = \"\"\n    else:\n        feedback = \"Action type is not 'take', counted as success.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'take', if the agent's hand is already holding an item, the action will fail; Checking Method: Check if 'item_in_hand' in 'initial_state' has a non-null 'item_name' and the 'status' is not 'null'. \ndef Rule_2_take(state, action, scene_graph):\n    item_in_hand = state.get(\"item_in_hand\", {})\n    \n    # Check if the action is 'take'\n    if action[\"name\"] == \"take\":\n        # Check if the agent's hand is already holding an item\n        if item_in_hand.get(\"item_name\") and item_in_hand.get(\"status\") != \"null\":\n            feedback = \"Action failed: You are already holding an item.\"\n            success = False\n            suggestion = \"Please put down the item you are holding before taking another one.\"\n        else:\n            feedback = \"Action executed successfully.\"\n            success = True\n            suggestion = \"\"\n    else:\n        feedback = \"Action executed successfully.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 4: For action 'take', if the location is not open, the action will fail; Checking Method: Check if 'current_position' in 'initial_state' has a 'status' that is not 'open' for the 'source' location in 'action'. \ndef Rule_4_take(state, action, scene_graph):\n    current_position = state['current_position']\n    source = action['args']['source']\n    \n    # Check if the current position is the source location\n    if current_position['location_name'] == source:\n        # Check if the status of the current position is not open\n        if current_position['status'] != 'open':\n            feedback = \"The action failed because the location is not open.\"\n            success = False\n            suggestion = f\"Please open the {source} before trying to take the item.\"\n            return feedback, success, suggestion\n    \n    # If the action type is not 'take', count as success\n    if action['name'] != 'take':\n        feedback = \"The action is not a 'take' action, so it is considered successful.\"\n        success = True\n        suggestion = \"\"\n        return feedback, success, suggestion\n    \n    # If the action is 'take' and the location is open\n    feedback = \"The action was successful.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 1: For action 'open', if the target location is not in the list of reachable locations or the current position is not the same as the target location, the action will fail; Checking Method: Check if 'action.args.target' is not in 'reachable_locations' or 'current_position.location_name' is not equal to 'action.args.target'. \ndef Rule_1_open(state, action, scene_graph):\n    target = action['args']['target']\n    reachable_locations = state['reachable_locations']\n    current_position = state['current_position']['location_name']\n    \n    if action['name'] == 'open':\n        if target not in reachable_locations or current_position != target:\n            feedback = \"The action to open failed because the target location is not reachable or you are not at the target location.\"\n            success = False\n            suggestion = f\"Please go to the position '{target}' if it is reachable, or choose a different location to open.\"\n        else:\n            feedback = \"The action to open was successful.\"\n            success = True\n            suggestion = \"\"\n    else:\n        feedback = \"The action type is not 'open', so it is considered successful.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'open', if the target location is not in the list of reachable locations or the current position is not the same as the target location, the action will fail; Checking Method: Check if 'action.args.target' is not in 'reachable_locations' or 'current_position.location_name' is not equal to 'action.args.target'. \ndef Rule_2_open(state, action, scene_graph):\n    target = action['args']['target']\n    reachable_locations = state['reachable_locations']\n    current_position = state['current_position']['location_name']\n    \n    if action['name'] == 'open':\n        if target not in reachable_locations or current_position != target:\n            feedback = \"The action to open failed because the target location is not reachable or you are not at the target location.\"\n            success = False\n            suggestion = f\"Please go to the position '{target}' if it is reachable, or choose a different location to open.\"\n        else:\n            feedback = \"The action to open was successful.\"\n            success = True\n            suggestion = \"\"\n    else:\n        feedback = \"The action type is not 'open', so it is considered successful.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 3: For action 'open', if the target location is already open, the action will fail; Checking Method: Check if 'current_position.status' is 'open' and 'current_position.location_name' is equal to 'action.args.target'. \ndef Rule_3_open(state, action, scene_graph):\n    target = action['args']['target']\n    current_position = state['current_position']\n    \n    if action['name'] == 'open':\n        if current_position['status'] == 'open' and current_position['location_name'] == target:\n            feedback = \"The action failed because the target location is already open.\"\n            success = False\n            suggestion = f\"You can try closing the {target} first before opening it.\"\n        else:\n            feedback = \"The action was successful.\"\n            success = True\n            suggestion = \"\"\n    else:\n        feedback = \"The action was successful.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 1: For action 'heat', if the tool is not empty or contains other items, the action will fail; Checking Method: Check if the 'items_in_locations' for the tool location contains items other than the object to be heated. \ndef Rule_1_heat(state, action, scene_graph):\n    feedback = \"\"\n    success = True\n    suggestion = \"\"\n\n    if action[\"name\"] == \"heat\":\n        tool = action[\"args\"][\"tool\"]\n        obj = action[\"args\"][\"obj\"]\n        tool_location = state[\"current_position\"][\"location_name\"]\n\n        # Check if the tool location contains items other than the object to be heated\n        items_in_tool_location = state[\"items_in_locations\"].get(tool_location, [])\n        \n        if tool in items_in_tool_location:\n            items_in_tool_location.remove(tool)  # Remove the tool itself for checking\n        if any(item != obj for item in items_in_tool_location):\n            feedback = \"The heating action failed because the tool location contains other items.\"\n            success = False\n            suggestion = f\"Please ensure that the '{tool}' is empty or only contains the '{obj}' to be heated.\"\n        else:\n            feedback = \"The heating action was successful.\"\n    else:\n        feedback = \"The action type is not 'heat', so it is considered successful.\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'heat', if the object to be heated is not in the tool, the action will fail; Checking Method: Check if the 'item_in_hand' matches the object to be heated and is not placed in the tool location. \ndef Rule_2_heat(state, action, scene_graph):\n    target_item = action['args']['obj']\n    tool = action['args']['tool']\n    item_in_hand = state['item_in_hand']['item_name']\n    \n    # Check if the action is 'heat'\n    if action['name'] == 'heat':\n        # Check if the item to be heated is in hand\n        if item_in_hand == target_item:\n            feedback = \"The action was successful.\"\n            success = True\n            suggestion = \"\"\n        else:\n            feedback = \"The action failed because the item to be heated is not in hand.\"\n            success = False\n            suggestion = f\"Please take the '{target_item}' before trying to heat it.\"\n    else:\n        feedback = \"The action type is not 'heat', so it is considered successful.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 1: For action 'go to', if the target location is not in the list of reachable locations, the action will fail; Checking Method: Check if the 'target' in 'action' is not present in 'reachable_locations' in 'initial_state'. \ndef Rule_1_go to(state, action, scene_graph):\n    target = action['args']['target']\n    \n    if action['name'] == 'go_to':\n        if target not in state['reachable_locations']:\n            feedback = f\"Failed to go to {target}. It's not reachable.\"\n            success = False\n            suggestion = f\"Please choose a reachable location to go to, such as {', '.join(state['reachable_locations'])}.\"\n        else:\n            feedback = f\"Successfully went to {target}.\"\n            success = True\n            suggestion = \"\"\n    else:\n        feedback = f\"Action '{action['name']}' is not a 'go to' action.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'go to', if the current position is the same as the target location and the target location is closed, the action will not fail; Checking Method: Check if 'current_position.location_name' is equal to 'target' in 'action' and 'current_position.status' is 'closed'. \ndef Rule_2_go to(state, action, scene_graph):\n    target = action['args']['target']\n    current_position = state['current_position']\n    \n    if action['name'] == 'go_to':\n        if current_position['location_name'] == target and current_position['status'] == 'closed':\n            feedback = \"You are already at the target location, but it is closed.\"\n            success = True\n            suggestion = \"You can wait until it opens or try another action.\"\n        else:\n            feedback = \"Action executed successfully.\"\n            success = True\n            suggestion = \"You can explore other locations or perform different actions.\"\n    else:\n        feedback = \"Action type is not 'go to', counted as success.\"\n        success = True\n        suggestion = \"Feel free to try another action.\"\n\n    return feedback, success, suggestion\n",
    "# Rule 3: For action 'go to', if the item in hand is not None and the target location is a container that is closed, the action will not fail; Checking Method: Check if 'item_in_hand.item_name' is not None and 'target' in 'action' is a container with 'status' as 'closed' in 'initial_state'. \ndef Rule_3_go to(state, action, scene_graph):\n    target = action['args']['target']\n    item_in_hand = state['item_in_hand']['item_name']\n    current_position_status = state['current_position']['status']\n    \n    # Check if the action is 'go_to'\n    if action['name'] == 'go_to':\n        # Check if item in hand is not None\n        if item_in_hand is not None:\n            # Check if the target location is a container and is closed\n            if target in state['reachable_locations'] and current_position_status == 'closed':\n                feedback = \"You can go to the target location.\"\n                success = True\n                suggestion = \"\"\n            else:\n                feedback = f\"You cannot go to {target} because it is not a closed container.\"\n                success = False\n                suggestion = f\"Please check if {target} is a closed container or choose another location.\"\n        else:\n            feedback = \"You have no item in hand.\"\n            success = True  # Success is True as per the rule\n            suggestion = \"You can still go to the target location.\"\n    else:\n        feedback = \"Action type is not 'go to'.\"\n        success = True  # Success is True as per the rule\n        suggestion = \"\"\n\n    return feedback, success, suggestion\n",
    "# Rule 1: For action 'put', if the target location is not reachable from the current position, the action will fail; Checking Method: Check if the 'target' in action args is in 'reachable_locations' of the 'initial_state'. \ndef Rule_1_put(state, action, scene_graph):\n    target = action['args']['target']\n    current_position = state['current_position']['location_name']\n    reachable_locations = state['reachable_locations']\n    \n    if action['name'] == 'put':\n        if target not in reachable_locations:\n            feedback = f\"Failed to put the item in {target} as it is not reachable from {current_position}.\"\n            success = False\n            suggestion = f\"Please move to a reachable location to put the item.\"\n        else:\n            feedback = f\"Successfully put the item in {target}.\"\n            success = True\n            suggestion = \"\"\n    else:\n        feedback = f\"Action '{action['name']}' is not a 'put' action, counted as success.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'put', if the item to be put is not in hand, the action will fail; Checking Method: Check if 'item_name' in 'item_in_hand' of the 'initial_state' matches the 'obj' in action args. \ndef Rule_2_put(state, action, scene_graph):\n    obj = action['args']['obj']\n    item_in_hand = state['item_in_hand']['item_name']\n    \n    if action['name'] == 'put':\n        if obj != item_in_hand:\n            feedback = f\"Failed to put {obj} because it is not in hand.\"\n            success = False\n            suggestion = f\"Please take the {obj} first before trying to put it.\"\n        else:\n            feedback = f\"Successfully put {obj}.\"\n            success = True\n            suggestion = \"\"\n    else:\n        feedback = f\"Action '{action['name']}' is not relevant to the rule.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 3: For action 'put', if the target location is already full or cannot accommodate the item, the action will fail; Checking Method: Check if the 'target' in action args is already filled with items in 'items_in_locations' of the 'initial_state'. Additionally, verify if the current position status is 'open' if the target is a container. \ndef Rule_3_put(state, action, scene_graph):\n    target = action['args']['target']\n    items_in_locations = state['items_in_locations']\n    current_position = state['current_position']\n    \n    # Check if the action is 'put'\n    if action['name'] == 'put':\n        # Check if the target location is in items_in_locations\n        if target in items_in_locations:\n            # Check if the target location is full\n            if len(items_in_locations[target]) > 0:  # Assuming non-empty means full\n                feedback = f\"The action to put the item in {target} failed because it is already full.\"\n                success = False\n                suggestion = f\"Please choose a different location that is empty or explore more to find an empty location.\"\n                return feedback, success, suggestion\n            \n            # Check if the current position is a container and its status is 'open'\n            if target in state['reachable_locations'] and current_position['status'] != 'open':\n                feedback = f\"The action to put the item in {target} failed because the current position is not open.\"\n                success = False\n                suggestion = f\"Please open the {target} before trying to put the item in it.\"\n                return feedback, success, suggestion\n        \n        # If the action type is not 'put', count as success\n        feedback = \"The action is not a 'put' action, so it is considered successful.\"\n        success = True\n        suggestion = \"\"\n        return feedback, success, suggestion\n    \n    # If the action is not 'put', count as success\n    feedback = \"The action is not a 'put' action, so it is considered successful.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 4: For action 'put', if the current position is not the same as the target location, the action will fail; Checking Method: Check if 'location_name' in 'current_position' of the 'initial_state' matches the 'target' in action args. \ndef Rule_4_put(state, action, scene_graph):\n    current_location = state['current_position']['location_name']\n    target_location = action['args']['target']\n    \n    if action['name'] == 'put':\n        if current_location == target_location:\n            feedback = \"The item has been successfully put in the target location.\"\n            success = True\n        else:\n            feedback = \"Failed to put the item. You are not in the target location.\"\n            success = False\n            suggestion = f\"Please go to the position '{target_location}' to put the item.\"\n            return feedback, success, suggestion\n    \n    # If the action type is not 'put', count as success\n    feedback = \"The action was executed successfully.\"\n    success = True\n    suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 1: For action 'use', if the object is not a tool or appliance, the action will fail; Checking Method: Check if the object specified in the action is not categorized as a tool or appliance in the initial state. \ndef Rule_1_use(state, action, scene_graph):\n    obj = action['args']['obj']\n    \n    # Define a list of tools and appliances based on the context\n    tools_and_appliances = [\n        \"blender\", \"microwave\", \"toaster\", \"stove\", \"oven\", \"fridge\", \n        \"coffee machine\", \"kettle\", \"pan\", \"pot\", \"knife\", \"fork\", \n        \"spoon\", \"cutting board\", \"dishwasher\", \"grater\", \"peeler\", \n        \"whisk\", \"measuring cup\", \"mixing bowl\", \"baking tray\", \n        \"food processor\", \"can opener\", \"scissors\", \"tongs\", \"ladle\"\n    ]\n    \n    # Check if the object is a tool or appliance\n    if obj not in tools_and_appliances:\n        feedback = f\"The action 'use' on '{obj}' failed because it is not a tool or appliance.\"\n        success = False\n        suggestion = \"Please use a valid tool or appliance instead.\"\n    else:\n        feedback = f\"The action 'use' on '{obj}' was successful.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'use', if the object is not in the current location, the action will fail; Checking Method: Check if the object specified in the action is not present in the 'items_in_locations' of the 'current_position' in the initial state. \ndef Rule_2_use(state, action, scene_graph):\n    current_location = state['current_position']['location_name']\n    items_in_current_location = state['items_in_locations'].get(current_location, [])\n    \n    obj_to_use = action['args']['obj']\n    \n    if action['name'] == 'use':\n        if obj_to_use not in items_in_current_location:\n            feedback = f\"The action to use the {obj_to_use} failed because it is not present in the current location.\"\n            success = False\n            suggestion = f\"Please check if the {obj_to_use} is in your current location '{current_location}' or move to a location where it is available.\"\n        else:\n            feedback = f\"The action to use the {obj_to_use} was successful.\"\n            success = True\n            suggestion = \"\"\n    else:\n        feedback = f\"The action '{action['name']}' is not relevant to the rule.\"\n        success = True  # Actions that are not 'use' are considered successful by default\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 1: For action 'cool', if the tool (e.g., fridge) is already full and cannot accommodate more items, the action will fail; Checking Method: Check if the number of items in the tool's location exceeds its capacity. \ndef Rule_1_cool(state, action, scene_graph):\n    feedback = \"\"\n    success = True\n    suggestion = \"\"\n\n    if action[\"name\"] == \"cool\":\n        tool = action[\"args\"][\"tool\"]\n        items_in_tool_location = state[\"items_in_locations\"].get(tool, [])\n        \n        # Assuming the capacity of the fridge is 5 for this example\n        capacity = 5\n        \n        if len(items_in_tool_location) >= capacity:\n            feedback = f\"The action to cool using {tool} failed because it is full.\"\n            success = False\n            suggestion = f\"Please check if there is space in the {tool} or consider using another cooling method.\"\n        else:\n            feedback = f\"The action to cool using {tool} was successful.\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'cool', if the item to be cooled is already in hand and not placed in the tool, the action will fail; Checking Method: Check if the item to be cooled is in hand and not in the tool's location. \ndef Rule_2_cool(state, action, scene_graph):\n    item_to_cool = action['args']['obj']\n    tool = action['args']['tool']\n    \n    # Check if the item to be cooled is in hand\n    item_in_hand = state['item_in_hand']['item_name']\n    \n    # Check if the tool is in the current position\n    current_position = state['current_position']['location_name']\n    tool_in_location = tool in scene_graph['graph']['locations'][current_position]\n    \n    # Determine success and feedback\n    if item_in_hand == item_to_cool and not tool_in_location:\n        feedback = f\"Failed to cool {item_to_cool} because it is in hand and the tool is not in the correct location.\"\n        success = False\n        suggestion = f\"Please place the {item_to_cool} down or ensure the {tool} is in your current location to cool it.\"\n    else:\n        feedback = f\"Successfully initiated cooling of {item_to_cool}.\"\n        success = True\n        suggestion = \"\"\n    \n    return feedback, success, suggestion\n",
    "# Rule 1: For action close [object], if the current position is the same as the target and the target is open, the action will fail; Checking Method: Check if 'current_position.location_name' is equal to 'target' and 'current_position.status' is 'open'. \ndef Rule_1_close(state, action, scene_graph):\n    target = action['args']['target']\n    \n    # Check if the action is 'close'\n    if action['name'] == 'close':\n        # Check if the current position is the same as the target and the target is open\n        if state['current_position']['location_name'] == target and state['current_position']['status'] == 'open':\n            feedback = \"The action to close the target failed because it is currently open.\"\n            success = False\n            suggestion = f\"Please ensure that the target '{target}' is closed before attempting to close it.\"\n            return feedback, success, suggestion\n    \n    # If the action is not 'close' or the conditions for failure are not met\n    feedback = \"The action was executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 1: For action clean, if the tool is not present in the current location, the action will fail; Checking Method: Check if the tool specified in the action is listed under 'items_in_locations' for the 'current_position'. \ndef Rule_1_clean(state, action, scene_graph):\n    current_location = state['current_position']['location_name']\n    tool = action['args']['tool']\n    \n    # Check if the action is 'clean'\n    if action['name'] == 'clean':\n        # Check if the tool is present in the current location\n        if tool in state['items_in_locations'].get(current_location, []):\n            feedback = \"The cleaning action was successful.\"\n            success = True\n        else:\n            feedback = f\"The cleaning action failed because the tool '{tool}' is not present in '{current_location}'.\"\n            success = False\n            suggestion = f\"Please find the tool '{tool}' in one of the reachable locations or check if it's in your hand.\"\n            return feedback, success, suggestion\n    \n    # If the action is not 'clean', count as success\n    feedback = \"The action was executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 2: For action clean, if the tool is not suitable for cleaning, the action will fail; Checking Method: Check if the tool specified in the action is a cleaning tool like 'dishsponge' or a location like 'sinkbasin'. \ndef Rule_2_clean(state, action, scene_graph):\n    tool = action['args']['tool']\n    \n    # Define suitable cleaning tools and locations\n    suitable_tools = ['dishsponge']\n    suitable_locations = ['sinkbasin']\n    \n    # Check if the tool is suitable\n    if tool in suitable_tools or tool in suitable_locations:\n        feedback = \"The cleaning action was successful.\"\n        success = True\n    else:\n        feedback = \"The cleaning action failed because the tool is not suitable for cleaning.\"\n        success = False\n        suggestion = f\"Please use a suitable cleaning tool like 'dishsponge' or use a location like 'sinkbasin' for cleaning.\"\n    \n    return feedback, success, suggestion if not success else \"\"\n"
]