[
    "# Rule 1: For action 'take', if the item is not present in the specified location, the action will fail; Checking Method: Check if the 'obj' in 'action' is not listed under 'items_in_locations' for the 'source' location in 'initial_state'. \ndef Rule_1_take(state, action, scene_graph):\n    # Extract action details\n    action_name = action.get(\"name\")\n    action_args = action.get(\"args\", {})\n    \n    # Check if the action is 'take'\n    if action_name == \"take\":\n        obj = action_args.get(\"obj\")\n        source = action_args.get(\"source\")\n        \n        # Check if the object is present in the specified source location\n        items_in_source = state.get(\"items_in_locations\", {}).get(source, [])\n        \n        if obj not in items_in_source:\n            feedback = f\"Action failed: {obj} is not present in {source}.\"\n            success = False\n            suggestion = f\"Check the items in {source} and try taking an available item.\"\n            return feedback, success, suggestion\n    \n    # If the action is not 'take', consider it successful\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'take', if the agent's hand is already holding an item, the action will fail; Checking Method: Check if 'item_in_hand' in 'initial_state' has a non-null 'item_name'. \ndef Rule_2_take(state, action, scene_graph):\n    # Extract the action name\n    action_name = action.get(\"name\")\n    \n    # Check if the action is 'take'\n    if action_name == \"take\":\n        # Check if the agent's hand is already holding an item\n        item_in_hand = state.get(\"item_in_hand\", {}).get(\"item_name\")\n        if item_in_hand:\n            feedback = \"Action failed: The agent is already holding an item.\"\n            success = False\n            suggestion = \"Put down the current item before taking another one.\"\n            return feedback, success, suggestion\n    \n    # If the action is not 'take', consider it successful by default\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 3: For action 'take', if the agent is not at the specified location, the action will fail; Checking Method: Check if 'current_position' in 'initial_state' does not match the 'source' location in 'action'. \ndef Rule_3_take(state, action, scene_graph):\n    if action['name'] == 'take':\n        current_location = state['current_position']['location_name']\n        source_location = action['args']['source']\n        \n        if current_location != source_location:\n            feedback = \"Action failed: You are not at the specified location to take the item.\"\n            success = False\n            suggestion = f\"Move to {source_location} before attempting to take the item.\"\n            return feedback, success, suggestion\n    \n    # If the action is not 'take', consider it successful by default\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'open', if the target location is not in the list of reachable locations, the action will fail; Checking Method: Check if 'action.args.target' is not in 'reachable_locations'. \ndef Rule_2_open(state, action, scene_graph):\n    if action['name'] == 'open':\n        target = action['args']['target']\n        if target not in state['reachable_locations']:\n            feedback = f\"Action failed: The target location '{target}' is not reachable.\"\n            success = False\n            suggestion = f\"Try moving closer to '{target}' before attempting to open it.\"\n            return feedback, success, suggestion\n    # If the action is not 'open', consider it successful by default\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 7: For action 'open', if the target location is a fridge and the current position is not the same as the target location, the action will fail; Checking Method: Check if 'action.args.target' is 'fridge' and 'current_position.location_name' is not equal to 'action.args.target'. \ndef Rule_7_open(state, action, scene_graph):\n    # Extract necessary information from state and action\n    current_position = state[\"current_position\"][\"location_name\"]\n    action_name = action[\"name\"]\n    target = action[\"args\"].get(\"target\", \"\")\n\n    # Check if the action is 'open' and the target is a fridge\n    if action_name == \"open\" and \"fridge\" in target:\n        # Check if the current position is not the same as the target location\n        if current_position != target:\n            feedback = \"Action failed: You must be at the fridge to open it.\"\n            success = False\n            suggestion = f\"Move to {target} before trying to open it.\"\n            return feedback, success, suggestion\n\n    # If the action is not 'open' or the rule does not apply, consider it successful\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 10: For action 'open', if the target location is a drawer and the current position is not the same as the target location, the action will fail; Checking Method: Check if 'action.args.target' starts with 'drawer' and 'current_position.location_name' is not equal to 'action.args.target'. \ndef Rule_10_open(state, action, scene_graph):\n    # Extract necessary information from state and action\n    current_position = state[\"current_position\"][\"location_name\"]\n    action_name = action[\"name\"]\n    target_location = action[\"args\"].get(\"target\", \"\")\n\n    # Check if the action is 'open' and the target is a drawer\n    if action_name == \"open\" and target_location.startswith(\"drawer\"):\n        # Check if the current position is not the same as the target location\n        if current_position != target_location:\n            feedback = \"Action failed: You must be at the drawer to open it.\"\n            success = False\n            suggestion = f\"Move to {target_location} before trying to open it.\"\n            return feedback, success, suggestion\n\n    # If the action is not 'open' or the rule does not apply, consider it successful\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'heat', if the object to be heated is not in the tool, the action will fail; Checking Method: Check if the 'item_in_hand' matches the object to be heated and is not placed in the tool location. \ndef Rule_2_heat(state, action, scene_graph):\n    # Extract necessary information from the state and action\n    action_name = action.get(\"name\")\n    action_args = action.get(\"args\", {})\n    obj_to_heat = action_args.get(\"obj\")\n    tool = action_args.get(\"tool\")\n    \n    # Check if the action is 'heat'\n    if action_name == \"heat\":\n        # Check if the object to be heated is in hand and not in the tool location\n        item_in_hand = state.get(\"item_in_hand\", {}).get(\"item_name\")\n        current_position = state.get(\"current_position\", {}).get(\"location_name\")\n        \n        if item_in_hand == obj_to_heat and current_position != tool:\n            feedback = f\"Failed to heat {obj_to_heat}. It must be placed in {tool} to be heated.\"\n            success = False\n            suggestion = f\"Place {obj_to_heat} in {tool} before heating.\"\n            return feedback, success, suggestion\n    \n    # If the action is not 'heat', consider it successful\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'put', if the item to be put is not in hand, the action will fail; Checking Method: Check if 'item_name' in 'item_in_hand' of the 'initial_state' matches the 'obj' in action args. \ndef Rule_2_put(state, action, scene_graph):\n    if action['name'] == 'put':\n        obj_to_put = action['args']['obj']\n        item_in_hand = state['item_in_hand']['item_name']\n        \n        if obj_to_put != item_in_hand:\n            feedback = f\"Action failed: {obj_to_put} is not in hand.\"\n            success = False\n            suggestion = f\"Ensure you have {obj_to_put} in hand before attempting to put it.\"\n            return feedback, success, suggestion\n    \n    # If the action is not 'put', consider it successful by default\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 4: For action 'put', if the current position is not the same as the target location, the action will fail; Checking Method: Check if 'location_name' in 'current_position' of the 'initial_state' matches the 'target' in action args. \ndef Rule_4_put(state, action, scene_graph):\n    if action['name'] == 'put':\n        current_location = state['current_position']['location_name']\n        target_location = action['args']['target']\n        \n        if current_location != target_location:\n            feedback = \"Action failed: You must be at the target location to put the item.\"\n            success = False\n            suggestion = f\"Move to {target_location} before attempting to put the item.\"\n            return feedback, success, suggestion\n    \n    # If the action is not 'put', consider it successful by default\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 2: For action 'use', if the object is not in the current location, the action will fail; Checking Method: Check if the object specified in the action is not present in the 'items_in_locations' of the 'current_position' in the initial state. \ndef Rule_2_use(state, action, scene_graph):\n    if action['name'] == 'use':\n        obj = action['args']['obj']\n        current_location = state['current_position']['location_name']\n        \n        # Check if the object is in the current location\n        if obj not in state['items_in_locations'].get(current_location, []):\n            feedback = f\"Action failed: {obj} is not in the current location {current_location}.\"\n            success = False\n            suggestion = f\"Move to the location where {obj} is present or bring {obj} to the current location.\"\n            return feedback, success, suggestion\n    \n    # If the action is not 'use', consider it successful\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 4: For action clean, if the object to be cleaned is not in hand, the action will fail; Checking Method: Check if the 'item_in_hand' matches the object specified in the action. \ndef Rule_4_clean(state, action, scene_graph):\n    # Extract the action name and arguments\n    action_name = action.get(\"name\")\n    action_args = action.get(\"args\", {})\n    \n    # Check if the action is 'clean'\n    if action_name == \"clean\":\n        # Get the object to be cleaned from the action arguments\n        obj_to_clean = action_args.get(\"obj\")\n        \n        # Get the item currently in hand\n        item_in_hand = state.get(\"item_in_hand\", {}).get(\"item_name\")\n        \n        # Check if the object to be cleaned is in hand\n        if obj_to_clean != item_in_hand:\n            feedback = f\"Action failed: {obj_to_clean} is not in hand.\"\n            success = False\n            suggestion = f\"Please ensure {obj_to_clean} is in hand before cleaning.\"\n            return feedback, success, suggestion\n    \n    # If the action is not 'clean', consider it successful\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n",
    "# Rule 3: For action 'go to', if the item specified by 'item_name' in 'item_in_hand' is None and the action's 'target' in the Scene Graph is not 'Unexplored' or does not contain the state's 'target_item' in the list, the action will fail; Checking Method: Check if 'item_in_hand.item_name' is None, and validate if the 'target' in 'action' is either not labeled 'Unexplored' or does not include the 'target_item' in the Scene Graph. \ndef Rule_3_go_to(state, action, scene_graph):\n    # Extract necessary information from state and action\n    item_in_hand = state[\"item_in_hand\"][\"item_name\"]\n    target_item = state[\"target_item\"]\n    action_name = action[\"name\"]\n\n    # Check if the action is 'go_to'\n    if action_name == \"go to\":\n        target_location = action[\"args\"][\"target\"]\n        # Check if item in hand is None\n        if item_in_hand is None:\n            # Check if the target location is not 'Unexplored' and does not contain the target item\n            if target_location in scene_graph[\"locations\"]:\n                location_items = scene_graph[\"locations\"][target_location]\n                if \"Unexplored\" not in location_items and not any(target_item in item for item in location_items):\n                    # Search for a location containing the target item\n                    location_with_target_item = None\n                    unexplored_locations = []\n\n                    for location, items in scene_graph[\"locations\"].items():\n                        if any(target_item in item for item in items):\n                            location_with_target_item = location\n                            break  # Stop searching once a location with the target item is found\n                        if \"Unexplored\" in items:\n                            unexplored_locations.append(location)\n\n                    # Prepare suggestion string\n                    if location_with_target_item:\n                        suggestion = f\"According to scene graph. Please go to the location containing the target item: {location_with_target_item}.\"\n                    elif unexplored_locations:\n                        suggestion = (\n                            \"According to scene graph. \"\n                            \"Please explore the following unexplored locations: \"\n                            + \", \".join(unexplored_locations) + \".\"\n                        )\n                    else:\n                        suggestion = \"No valid locations found that contain the target item or are unexplored.\"\n\n                    feedback = f\"Action failed: There is no {target_item} in {target_location} \"\n                    success = False\n                    return feedback, success, suggestion\n\n    # If the action is not 'go_to' or the conditions are not met, consider it successful\n    feedback = \"Action executed successfully.\"\n    success = True\n    suggestion = \"\"\n    return feedback, success, suggestion\n"
]

